input {
    udp {
        port => 9005
        tags => ["meraki"]
    }
}

filter {
    grok {
        match => { "message" => "%{SYSLOG5424PRI}%{NUMBER}%{SPACE}%{NUMBER}%{SPACE}%{WORD:devname}%{SPACE}%{WORD}%{SPACE}%{GREEDYDATA:message}" }
        overwrite => [ "message" ]
    }
    mutate {
        add_field => { "source" => "${HOSTNAME}" }
    }
    mutate {
        replace => { "message" => "%{message} devip=%{[host][ip]}" }
    }
}

output {
    stdout {}
    loki {
        url => "http://loki:3100/loki/api/v1/push"
        include_fields => ["source"]
        message_field => "message"
    }
}